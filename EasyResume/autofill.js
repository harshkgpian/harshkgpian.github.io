// jsonVersion.js

let defaultJson = {
  "personal": [
    {
      "name": "Sanika Yashwant Naik",
      "email": "sanikayashwantnaik@gmail.com",
      "phone": "+91-9820158226",
      "location": "Mumbai"
    }
  ],
  "summary": [
    {
      "summary": "Seasoned HR Business Partner with 4.5+ years at Wipro, specializing in strategic HR interventions, end-to-end recruitment management, and talent management for large, global technology accounts (1,600+ professionals). Proven ability to partner with senior leaders, drive talent acquisition for software engineering and product roles, enhance candidate experience, and implement diversity initiatives. Expertise in HR process transformation, performance management, compliance, and leveraging recruitment metrics and sourcing strategies via platforms like LinkedIn and Naukri.com to build strong talent pipelines and improve employer branding. Reduced employee attrition by 15% YoY."
    }
  ],
  "experience": [
    {
      "title": "Wipro Ltd",
      "subtitle": "Manager-HR",
      "duration": "September 2020 - Present",
      "location": "Mumbai",
      "bullets": [
        "Served as the primary HR Business Partner for major revenue-generating accounts in Capital Markets & Insurance, supporting 1,600+ professionals globally to optimize human capital.",
        "Managed comprehensive end-to-end people processes, encompassing account Talent Acquisition, Recruitment Management for promotions, merit salary increases, appraisals, talent review, and planning while ensuring strict Compliance with client SLAs.",
        "Successfully reduced employee attrition by 15% year-over-year through data-driven insights, analysis of Recruitment Metrics, and impactful HR initiatives fostering a performance-driven culture.",
        "Led ‘TalentFest’ & ‘RoleRotationDrive’ at WDC, implementing skill-based job matching and enhancing workforce agility to strengthen the internal Talent Pipeline.",
        "Anchored the 'Supers' program to develop top performers via strategic career mapping, technology exposure, and certified coaching sessions.",
        "Designed and launched ‘PMEssentials’ to effectively upskill Project Leads for managerial roles through targeted training, leadership development modules, and dedicated mentorship.",
        "Spearheaded ‘PowerUp’, enhancing collaboration, Communication Skills, and customer service among employees through interactive learning, self-paced modules, workshops, and real-world case studies.",
        "Directed the '5 Habits' Culture Transformation initiative, securing leadership buy-in and executing a strategic awareness campaign to embed cultural change across the organization.",
        "Established a continuous feedback loop integrated with Cultural Transformation efforts, collaborating with central teams to weave improvements into core people processes.",
        "Implemented structured engagement plans for New Gen Associates focused on Recognition, Collaboration, and Communication, enhancing their integration and skill development.",
        "Designed formal and informal engagement programs, including recognition initiatives and team-building activities, contributing positively to Employer Branding and workplace culture.",
        "Conducted Training Needs Analysis (TNA), aligning learning solutions with organizational goals by collaborating with business leaders and L&D teams, and managed the annual training calendar.",
        "Ensured rigorous Compliance and managed grievance resolution for assigned accounts, maintaining adherence to Geo labor laws and organizational policies.",
        "Authored the organization-level NGA Compliance Standard Operating Procedure (SOP), detailing the Fresher Engagement Matrix, Capability Framework, and Compliance Guidelines.",
        "Led a comprehensive Compliance Audit involving 200+ interviews to assess employee classification, roles, and adherence to U.S. labor laws using a legally vetted questionnaire.",
        "Championed Well-being Initiatives, organizing workshops and stress management programs, and drove Diversity Initiatives, boosting diversity in promotions by 10% based on quarterly dashboard metrics.",
        "Anchored key DEI initiatives like Pride Month celebrations and cultural awareness workshops, fostering inclusivity and managing Employee Resource Groups (ERGs).",
        "Prepared and presented the quarterly DEI dashboard to the Wipro DEI council, highlighting key Diversity Initiatives metrics and reflecting QOQ progress."
      ],
      "tags": [
        "HR Business Partner",
        "Talent Acquisition",
        "Recruitment Management",
        "Compliance",
        "Recruitment Metrics",
        "Talent Pipeline",
        "Communication Skills",
        "Employer Branding",
        "Diversity Initiatives",
        "Leadership",
        "Change Management",
        "Engagement",
        "Capability Building",
        "TNA",
        "Grievance Management",
        "DEI"
      ]
    },
    {
      "title": "THATMATE (Social Startup)",
      "subtitle": "Intern",
      "bullets": [
        "Developed and executed comprehensive content strategies to bolster marketing campaigns and refine brand messaging across diverse platforms.",
        "Collaborated effectively using strong Communication Skills with cross-functional teams, including designers and developers, to create engaging content.",
        "Worked closely with the CEO and COO to devise organizational strategies and secure funding through grants and competitions."
      ],
      "tags": [
        "Content Strategy",
        "Marketing Campaigns",
        "Brand Messaging",
        "Collaboration",
        "Communication Skills",
        "Organizational Strategy",
        "Funding"
      ]
    },
    {
      "title": "Honeywell",
      "subtitle": "Intern",
      "bullets": [
        "Benchmarked Honeywell's Recognition Practices by evaluating the technological infrastructure and tools of competitors.",
        "Recommended best practices including social recognition and peer-to-peer recognition features to foster increased employee engagement and enhance the overall Candidate Experience perception."
      ],
      "tags": [
        "Benchmarking",
        "Recognition Practices",
        "Employee Engagement",
        "Candidate Experience",
        "HR Tech"
      ]
    },
    {
      "title": "UPGRAD",
      "subtitle": "Intern",
      "bullets": [
        "Conducted benchmarking of career paths for various roles within the Education industry.",
        "Created career role trajectories to support succession planning and build a robust Talent Pipeline."
      ],
      "tags": [
        "Benchmarking",
        "Career Paths",
        "Succession Planning",
        "Talent Pipeline",
        "Education Industry"
      ]
    },
    {
      "title": "Wipro",
      "subtitle": "Intern",
      "bullets": [
        "Engaged Distinguished Members of Technical Society associates in Co-Innovation partnerships.",
        "Performed an in-depth gender diversity study for a Financial Services business unit, supporting Diversity Initiatives.",
        "Conducted hypothesis testing to analyze the effectiveness of promotions within the Financial sector."
      ],
      "tags": [
        "Co-Innovation",
        "Diversity Initiatives",
        "Gender Diversity",
        "Hypothesis Testing",
        "Financial Services"
      ]
    }
  ],
  "projects": [
    {
      "title": "Building a Role Competency Architecture",
      "subtitle": "Contributor",
      "bullets": [
        "Contributed to developing a talent framework of skill clusters aligned with client expectations.",
        "Aimed to balance supply-demand, analyze financial impacts, and support career growth, multi-skilling, and succession readiness for the Talent Pipeline through job rotations."
      ],
      "tags": [
        "Competency Architecture",
        "Talent Framework",
        "Skill Clusters",
        "Supply Demand",
        "Talent Pipeline",
        "Job Rotation"
      ]
    },
    {
      "title": "Wipro Career Essentials",
      "subtitle": "Core Team Member",
      "bullets": [
        "Participated in building a comprehensive, AI-integrated competency framework with 'Cymorg'.",
        "Combined practice-defined technical skills and role-based functional competencies for a unified assessment model covering over 5,000 employees in a major Digital unit."
      ],
      "tags": [
        "Competency Framework",
        "AI",
        "Technical Skills",
        "Functional Competencies",
        "Assessment Model"
      ]
    },
    {
      "title": "Research Paper on Revamping Relocation Policy",
      "subtitle": "Key Contributor",
      "duration": "November 2023 - Ongoing",
      "bullets": [
        "Playing a key role in research initiated to simplify complexities within Wipro's Global Relocation policy.",
        "Aiming to enhance relocation processes by addressing identified issues and examining industry trends for better Compliance and employee experience."
      ],
      "tags": [
        "Research",
        "Relocation Policy",
        "Compliance",
        "Process Improvement",
        "Industry Trends"
      ]
    },
    {
      "title": "Elevating Onboarding Experience",
      "subtitle": "Analyst",
      "bullets": [
        "Analyzed historical onboarding practices across various Geos, identifying trends and patterns.",
        "Conducted benchmarking against industry peers to pinpoint best practices for enhancing the Candidate Experience.",
        "Formulated a personalized onboarding strategy tailored to diverse geographies, contributing to Employer Branding."
      ],
      "tags": [
        "Onboarding",
        "Benchmarking",
        "Candidate Experience",
        "Employer Branding",
        "Process Improvement"
      ]
    },
    {
      "title": "Development of Success Profiles",
      "subtitle": "Collaborator",
      "bullets": [
        "Collaborated closely with the Talent Transformation Team to craft comprehensive success profiles for Leadership roles.",
        "Conducted thorough Competency-based Interviews with leaders to inform talent review and succession planning strategies.",
        "Ensured the development of a robust Talent Pipeline for critical leadership positions."
      ],
      "tags": [
        "Success Profiles",
        "Leadership Roles",
        "Competency-based Interviews",
        "Talent Review",
        "Succession Planning",
        "Talent Pipeline"
      ]
    }
  ],
  "education": [
    {
      "school": "SBM, NMIMS",
      "degree": "MBA-HR",
      "duration": "2020",
      "location": "Mumbai",
      "scoreType": "CGPA",
      "gpa": "3.2/4"
    },
    {
      "school": "RAIT",
      "degree": "BE (Computer Science)",
      "duration": "2017",
      "location": "Mumbai",
      "scoreType": "CGPA",
      "gpa": "7.8/10"
    }
  ],
  "certifications": [
    {
      "title": "Pursuing HR Ignite - HRBP certification by AON"
    },
    {
      "title": "Pursuing Gen-AI by CHRMP"
    },
    {
      "title": "Pursuing Lean Six Sigma - Black Belt"
    },
    {
      "title": "Lean Six Sigma Green Belt Certification"
    },
    {
      "title": "Tableau Software"
    },
    {
      "title": "Employing Abilities @Work - SHRM"
    },
    {
      "title": "Delivering Employee Feedback, Coaching and Developing - LinkedIn"
    },
    {
      "title": "Digital Marketing - Google Garage"
    },
    {
      "title": "International Leadership and Organizational Behaviours - LinkedIn"
    },
    {
      "title": "FLOW and C&B Certification by Wipro"
    }
  ],
  "awards": [
    {
      "title": "Multiple Recognitions",
      "subtitle": "Wipro Ltd",
      "bullets": [
        "Received 17 awards over 4.5 years during Quarterly All Hands Meets for successfully launching and implementing multiple initiatives, including accolades directly from clients."
      ],
      "tags": [
        "Recognition",
        "Initiative Implementation",
        "Client Accolades"
      ]
    }
  ],
  "skills": [
    {
      "category": "HR & Talent Acquisition",
      "skills": [
        "Talent Acquisition",
        "HR Business Partnering",
        "Recruitment Management",
        "Candidate Experience Enhancement",
        "Employer Branding",
        "Diversity Initiatives (DEI)",
        "Talent Pipeline Development",
        "Sourcing Strategies",
        "Competency-based Interviews",
        "Recruitment Metrics Analysis",
        "Compliance Management (Geo Labor Laws)",
        "HR Process Transformation",
        "Performance Management",
        "Talent Management",
        "Change Management",
        "Employee Engagement",
        "Capability Building",
        "Training Needs Analysis (TNA)",
        "Grievance Resolution",
        "Succession Planning",
        "Onboarding Strategy",
        "Campus Hiring (Implied through NGA programs)",
        "High-volume Hiring Support (Implied by scale)"
      ]
    },
    {
      "category": "Tools & Platforms",
      "skills": [
        "ATS (General Proficiency)",
        "HRIS (General Proficiency)",
        "LinkedIn Recruiter / Sourcing",
        "Naukri.com",
        "Global Job Boards (Implied)",
        "Tableau Software",
        "Microsoft Office Suite"
      ]
    },
    {
      "category": "Methodologies & Frameworks",
      "skills": [
        "Lean Six Sigma (Green Belt Certified, Black Belt Pursuing)",
        "Competency Framework Development"
      ]
    },
    {
      "category": "Soft Skills",
      "skills": [
        "Communication Skills",
        "Leadership",
        "Collaboration",
        "Stakeholder Management",
        "Problem-Solving",
        "Data Analysis",
        "Strategic Planning",
        "Cross-cultural Collaboration (Implied by global role)"
      ]
    }
  ]
}

let demoJSON = defaultJson;


// Helper function to detect and register custom sections
function detectCustomSections() {
    // Look through the JSON for sections that might not be in the default config
    const standardSections = ['personal', 'summary', 'education', 'experience', 'projects', 'skills'];
    
    // Find custom sections in the demo JSON
    const customSections = Object.keys(demoJSON).filter(key => !standardSections.includes(key));
    
    // Register each custom section
    customSections.forEach(sectionKey => {
        // Format section name for display (capitalize first letter)
        const sectionTitle = sectionKey.charAt(0).toUpperCase() + sectionKey.slice(1);
        
        // Check if we need to add to sectionCounter
        if (typeof sectionCounter !== 'undefined' && sectionCounter[sectionKey] === undefined) {
            sectionCounter[sectionKey] = 0;
        }
        
        // Check if we need to add to formData
        if (typeof formData !== 'undefined' && formData[sectionKey] === undefined) {
            formData[sectionKey] = [];
        }
        
        // Register the custom section in the config
        if (typeof updateConfigWithCustomSection === 'function') {
            updateConfigWithCustomSection(sectionKey, sectionTitle);
        } else {
            console.warn('updateConfigWithCustomSection function not found');
        }
        
        // Add button for the custom section if it doesn't exist
        createSectionButton(sectionKey, sectionTitle);
    });
    
    return customSections;
}

// Function to create buttons for custom sections
function createSectionButton(sectionKey, sectionTitle) {
    console.log('Creating button for custom section:', sectionKey);
    // Check if button already exists
    const existingButton = document.querySelector(`.add-btn[data-section="${sectionKey}"]`);
    if (existingButton) {
        return; // Don't create duplicates
    }
    
    // Create a new button and add it to the sidebar
    const sidebar = document.querySelector(".action-buttons");
    if (sidebar) {
        const newButton = document.createElement("button");
        newButton.className = "add-btn";
        newButton.setAttribute('data-section', sectionKey); // Mark with section type
        newButton.textContent = `Add ${sectionTitle}`;
        newButton.onclick = function() {
            if (typeof addSection === 'function') {
                addSection(sectionKey);
            } else {
                console.warn('addSection function not found');
            }
        };
        
        sidebar.appendChild(newButton);
    } else {
        console.warn('Sidebar element not found');
    }
}

// Function to clear all existing data before loading demo
function clearAllData() {
    // Get form container element and check if it exists
    const formContainer = document.getElementById('formContainer');
    if (formContainer) {
        formContainer.innerHTML = '';
    } else {
        console.warn('Form container element not found');
    }
    
    // Clear resume preview if it exists
    const resumeElement = document.getElementById('resume');
    if (resumeElement) {
        resumeElement.innerHTML = '';
    } else {
        console.warn('Resume element not found');
    }
    
    // Get all section types from the JSON
    const allSectionTypes = Object.keys(demoJSON);
    
    // Clear formData object
    if (typeof formData !== 'undefined') {
        // Reset formData with all section types
        formData = {
            personal: [],
            education: [],
            experience: [],
            projects: [],
            competitions: [],
            skills: []
        };
        
        // Add custom section types from JSON
        allSectionTypes.forEach(type => {
            if (!formData[type]) {
                formData[type] = [];
            }
        });
    } else {
        console.warn('formData variable not defined yet');
    }
    
    // Reset section counters
    if (typeof sectionCounter !== 'undefined') {
        sectionCounter = {
            personal: 0,
            education: 0,
            experience: 0,
            projects: 0,
            skills: 0,
            competitions: 0
        };
        
        // Add custom section types from JSON
        allSectionTypes.forEach(type => {
            if (!sectionCounter[type]) {
                sectionCounter[type] = 0;
            }
        });
    } else {
        console.warn('sectionCounter variable not defined yet');
    }
}

function populateSection(sectionType, sectionData) {
    if (!sectionData || !Array.isArray(sectionData) || sectionData.length === 0) {
        return;
    }

    sectionData.forEach(itemData => {
        addSection(sectionType);
        const sectionId = `${sectionType}-${sectionCounter[sectionType] - 1}`;
        const section = document.getElementById(sectionId);
        
        if (section) {
            Object.entries(itemData).forEach(([key, value]) => {
                if (key === 'bullets') {
                    // Find the bullets container
                    const bulletsContainer = section.querySelector(`#bullets-${sectionId}`);
                    if (bulletsContainer) {
                        // Clear any default bullet points
                        bulletsContainer.innerHTML = '';
                        
                        // Add each bullet point as a separate field
                        value.forEach(bulletText => {
                            addBulletField(sectionId, bulletsContainer, bulletText);
                        });
                    }
                } else if (key === 'tags') {
                    const input = section.querySelector('input[name="tags"]');
                    if (input) {
                        input.value = Array.isArray(value) ? value.join(', ') : value;
                    }
                } else if (key === 'skills') {
                    // Handle skills array for skills section
                    const skillsContainer = section.querySelector('.skills-container');
                    if (skillsContainer) {
                        value.forEach((skill, index) => {
                            if (index === 0) {
                                const firstSkillInput = skillsContainer.querySelector('input[name="skill"]');
                                if (firstSkillInput) {
                                    firstSkillInput.value = skill;
                                }
                            } else {
                                addSkillField(sectionId);
                                const inputs = skillsContainer.querySelectorAll('input[name="skill"]');
                                inputs[inputs.length - 1].value = skill;
                            }
                        });
                    }
                } else if (key === 'summary' && sectionType === 'summary') {
                    // Special handling for summary text
                    const textarea = section.querySelector('textarea[name="summary"]');
                    if (textarea) {
                        textarea.value = value;
                    }
                } else {
                    const input = section.querySelector(`input[name="${key}"]`);
                    const textarea = section.querySelector(`textarea[name="${key}"]`);
                    if (input) {
                        input.value = value;
                    } else if (textarea) {
                        textarea.value = value;
                    }
                }
            });
            updateFormData(sectionId);
            
            // Update section title
            let titleField = null;
            if (sectionType === 'education') {
                titleField = section.querySelector('input[name="school"]');
            } else if (sectionType === 'summary') {
                titleField = { value: 'Professional Summary' }; // Static title for summary
            } else if (sectionType === 'skills') {
                titleField = section.querySelector('input[name="category"]');
            } else if (sectionType === 'personal') {
                titleField = section.querySelector('input[name="name"]');
            }  else {
                titleField = section.querySelector('input[name="title"]');
            }
            
            if (titleField && titleField.value) {
                updateSectionTitle(sectionId, sectionType, titleField.value);
            }
        }
    });
}


function populateFromDemoJSON() {
    try {
        // First, detect and register any custom sections from the JSON
        const customSections = detectCustomSections();
        console.log('Detected custom sections:', customSections);
        
        // Update section order to include custom sections
        if (typeof sectionOrder !== 'undefined') {
            customSections.forEach(section => {
                if (!sectionOrder.includes(section)) {
                    sectionOrder.push(section);
                }
            });
            console.log('Updated section order:', sectionOrder);
        }
        
        // Populate all sections using our helper function
        Object.entries(demoJSON).forEach(([sectionType, sectionData]) => {
            if (sectionType !== 'skills') { // Skills needs special handling
                populateSection(sectionType, sectionData);
            }
        });
        
        // Special handling for Skills section
        if (demoJSON.skills && Array.isArray(demoJSON.skills)) {
            demoJSON.skills.forEach(skillCategory => {
                addSection('skills');
                const sectionId = `skills-${sectionCounter.skills - 1}`;
                const section = document.getElementById(sectionId);
                
                if (section) {
                    // Set category
                    const categoryInput = section.querySelector('input[name="category"]');
                    if (categoryInput) {
                        categoryInput.value = skillCategory.category;
                    }

                    // Add skills
                    const skillsContainer = section.querySelector('.skills-container');
                    if (skillsContainer) {
                        skillCategory.skills.forEach((skill, index) => {
                            if (index === 0) {
                                // Use existing first skill input
                                const firstSkillInput = skillsContainer.querySelector('input[name="skill"]');
                                if (firstSkillInput) {
                                    firstSkillInput.value = skill;
                                }
                            } else {
                                // Add new skill input for remaining skills
                                addSkillField(sectionId);
                                const inputs = skillsContainer.querySelectorAll('input[name="skill"]');
                                inputs[inputs.length - 1].value = skill;
                            }
                        });
                    }
                    updateFormData(sectionId);
                }
            });
        }

        // Generate resume preview
        console.log('Demo data loaded', sectionOrder);
        if (typeof generateResume === 'function' && typeof sectionOrder !== 'undefined') {
            generateResume(sectionOrder);
        } else {
            console.warn('generateResume function or sectionOrder not found');
        }
    } catch (error) {
        console.error('Error loading demo data:', error);
    }
}



// Function to load demo data
function loadDemoData() {
    try {
        // Clear any existing data before loading demo
        clearAllData();
        
        // Populate with demo data
        populateFromDemoJSON();
    } catch (error) {
        console.error('Error in loadDemoData:', error);
    }
}

function loadDefaultData() {
    try {
        // Clear any existing data before loading demo
        clearAllData();
        
        // Populate with demo data
        demoJSON = defaultJson;
        populateFromDemoJSON();
    } catch (error) {
        console.error('Error in loadDemoData:', error);
    }
}

// Function to create updated JSON from all form data
function createUpdatedJSON() {
    // Initialize the JSON structure with the same format as demoJSON
    const updatedJSON = {};
    
    // Collect data from all section types defined in sectionCounter
    Object.keys(sectionCounter).forEach(sectionType => {
      if (!updatedJSON[sectionType]) {
        updatedJSON[sectionType] = [];
      }
      
      // Skip if no data exists for this section type
      if (!formData[sectionType] || formData[sectionType].length === 0) {
        return;
      }
      
      // Process each item in this section type
      formData[sectionType].forEach(item => {
        const sectionData = {};
        
        // Handle special case for summary
        if (sectionType === 'summary') {
          if (item.fields.summary) {
            sectionData.summary = item.fields.summary;
          }
        } 
        // Handle special case for skills
        else if (sectionType === 'skills') {
          sectionData.category = item.fields.category || '';
          sectionData.skills = item.fields.skills || [];
        } 
        // Handle all other fields for standard and custom sections
        else {
          // Copy all fields except bullets and tags which need special handling
          Object.keys(item.fields).forEach(fieldName => {
            if (fieldName !== 'bullets' && fieldName !== 'tags' && fieldName !== 'skills') {
              sectionData[fieldName] = item.fields[fieldName] || '';
            }
          });
          
          // Handle bullets
          if (item.fields.bullets) {
            sectionData.bullets = Array.isArray(item.fields.bullets) ? 
              item.fields.bullets : 
              (typeof item.fields.bullets === 'string' ? 
                item.fields.bullets.split('\n').filter(b => b.trim() !== '') : []);
          }
          
          // Handle tags
          if (item.fields.tags) {
            sectionData.tags = typeof item.fields.tags === 'string' ? 
              item.fields.tags.split(',').map(tag => tag.trim()).filter(tag => tag !== '') : 
              (Array.isArray(item.fields.tags) ? item.fields.tags : []);
          }
        }
        
        // Only add non-empty section data
        if (Object.keys(sectionData).length > 0) {
          updatedJSON[sectionType].push(sectionData);
        }
      });
      
      // Remove empty arrays
      if (updatedJSON[sectionType].length === 0) {
        delete updatedJSON[sectionType];
      }
    });
    
    return updatedJSON;
  }
  
  // Function to log the updated JSON to console
  function logUpdatedJSON() {
    const updatedJSON = createUpdatedJSON();
    console.log('Updated Resume JSON:');
    console.log(JSON.stringify(updatedJSON, null, 2));
        
    return updatedJSON;
  }
  
  
// Remove the JSON buttons function completely
function addJSONButtons() {
    // This function is now empty - we're removing the buttons
  }
  
  // Save to localStorage when JSON is updated
  function saveToLocalStorage() {
    const updatedJSON = createUpdatedJSON();
    const updatedsectionOrder = getSectionOrder();
    localStorage.setItem('sectionOrder', updatedsectionOrder);
    localStorage.setItem('resumeData', JSON.stringify(updatedJSON));
  }
  
  // Modified window.onload function
  window.onload = function() {
    try {
      // Check if there's data in localStorage
      const savedData = localStorage.getItem('resumeData');
      const savedOrder = localStorage.getItem('sectionOrder');
      
      if (savedData && savedOrder) {
        // Use the saved data
        demoJSON = JSON.parse(savedData);
        sectionOrder = savedOrder.split(',');
        console.log('sectionOrder from localStorage:', sectionOrder);
        console.log('Loaded data from localStorage');
      }
      
      // Load data (either from localStorage or the default demo)
      loadDemoData();
      
      // Setup event listener to save on form changes
      document.addEventListener('change', saveToLocalStorage);
      
      // Initialize collapsed sections if the function exists
      if (typeof initializeCollapsedGroups === 'function') {
        initializeCollapsedGroups();
      }
    } catch (error) {
      console.error('Error in window.onload:', error);
    }
  };
