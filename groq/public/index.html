<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Girlfriend</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Create Your Virtual Girlfriend</h1>
        <form id="girlfriendForm" class="input-form">
            <div class="input-group">
                <label for="userName">Your Name:</label>
                <input type="text" id="userName" name="userName" required>
            </div>
            <div class="input-group">
                <label for="girlfriendName">Girlfriend's Name:</label>
                <input type="text" id="girlfriendName" name="girlfriendName" required>
            </div>
            <div class="input-group">
                <label for="girlfriendPersonality">Girlfriend's Personality:</label>
                <select id="girlfriendPersonality" name="girlfriendPersonality" required>
                    <option value="">Select Personality</option>
                    <option value="Witty and Caring">Witty and Caring</option>
                    <option value="Sassy and Playful">Sassy and Playful</option>
                    <option value="Sweet and Romantic">Sweet and Romantic</option>
                    <option value="Intelligent and Empathetic">Intelligent and Empathetic</option>
                </select>
            </div>
            <div class="input-group">
                <label for="girlfriendInterests">Girlfriend's Interests:</label>
                <input type="text" id="girlfriendInterests" name="girlfriendInterests" required>
           </div>
            <div id="girlfriendMessage" class="message-container"></div>
            <div class="input-group message-input-group">
                <input type="text" id="message" name="message" required>
                <button type="submit" id="sendMessageButton"><img src="send_icon.png" alt="Send" width="25px" height="20px"></button>
            </div>
        </form>
    </div>

    <script>
        const maxMessages = 20; // Maximum number of messages allowed
        let messageCount = 0; // Counter for the number of messages sent

        document.getElementById('girlfriendForm').addEventListener('submit', function(event) {
            event.preventDefault();

            // Increment message count
            messageCount++;

            if (messageCount <= maxMessages) {
                const userName = document.getElementById('userName').value;
                const girlfriendName = document.getElementById('girlfriendName').value;
                const girlfriendPersonality = document.getElementById('girlfriendPersonality').value;
                const girlfriendInterests = document.getElementById('girlfriendInterests').value;
                const message = document.getElementById('message').value;

                createVirtualGirlfriend(userName, girlfriendName, girlfriendPersonality, girlfriendInterests, message);
            } else {
                alert("You can only send a maximum of 20 messages.");
            }
        });

        let conversationHistory = []; // Store conversation history

        async function createVirtualGirlfriend(userName, girlfriendName, girlfriendPersonality, girlfriendInterests, message) {
            if (message.toLowerCase().includes("bye") || message.toLowerCase().includes("exit")) {
                displayConversation([{ role: 'girlfriend', content: "Goodbye! Have a great day!" }], userName, girlfriendName);
                return;
            }

            // Append the latest message to the conversation history
            conversationHistory.push({ role: 'user', content: message });

            const response = await fetch('/createGirlfriend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userName: userName,
                    girlfriendName: girlfriendName,
                    girlfriendPersonality: girlfriendPersonality,
                    girlfriendInterests: girlfriendInterests,
                    conversationHistory: conversationHistory // Send entire conversation history
                })
            });

            const data = await response.json();
            conversationHistory.push({ role: 'girlfriend', content: data }); // Add girlfriend response to history
            displayConversation(conversationHistory, userName, girlfriendName);
        }

        function displayConversation(conversation, userName, girlfriendName) {
            const girlfriendMessageContainer = document.getElementById('girlfriendMessage');
            let html = '';
            conversation.forEach(message => {
                if (message.role === 'user') {
                    html += `<div class="message user"><span class="username">${userName}</span>: ${message.content}</div>`;
                } else if (message.role === 'girlfriend') {
                    html += `<div class="message girlfriend"><span class="username">${girlfriendName}</span>: ${message.content}</div>`;
                }
            });
            girlfriendMessageContainer.innerHTML = html;
            girlfriendMessageContainer.scrollTop = girlfriendMessageContainer.scrollHeight; // Scroll to bottom
        }
    </script>
</body>
</html>
